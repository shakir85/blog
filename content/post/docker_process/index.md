---
title: "Docker containers process"
description: "Learn how to access container's process and filesystem directly from the host"
date: 2023-04-22T11:17:28-07:00
draft: false
tags: ["good to know"]
categories: ["docker", "linux"]
---

A Docker container is a process, isolated from the host as well as other containers, running on the system using various Linux kernel features, such as namespaces and cgroups. And this is an essential differentiator between virtual machines and containers.

When you start a Docker container, Docker creates a new process in the host system's process tree, and applies the container's configuration, including its file system, network settings, and more, to this process. This process is then isolated from other processes on the host system, as well as other containers running on the system, using the earlier mentioned kernel features.

From the perspective of the host system, a Docker container appears as just another process running on the system. You can use standard process monitor tools, such as `ps` and `top`, to view and manage Docker.

In this blog post, we will examine how to find and access a container's process ID (PID) and root-filesystem directly from the host machine.

## Getting Started...

Let's spin up a container and tinker with it
```text
docker run -d --name nginx nginx:latest
```

## Access container PID

Docker stores detailed information about the container such as its image, configuration, volume, process id, or network in a low-level object. When you run the `docker inspect` command, it returns a JSON object that contains all of the confi information and metadata associated with the specified Docker object. In our case, we are only interested in the container's PID

```sh
# SYNTAX: docker inspect -f '{{.State.Pid}}' <CONTAINER_ID|CONTAINER_NAME>
docker inspect -f '{{.State.Pid}}' nginx
```

## Check the `/proc` directory

In Linux, the `/proc` directory is a virtual file system that provides a view of the system's running processes and their current status. It contains files and directories that are dynamically generated by the kernel to provide information about the system's processes, hardware, and other system information. 

Each process running on the system has its own subdirectory under `/proc`, identified by its process ID (PID). Inside the PID subdirectory, you can find various files that provide information about the process, such as its memory usage, file descriptors, and more.

So, since the Nginx container that we spun up previously is just a process, we should see a directory named after its PID in `/proc`.

Let's re-run the above command and assign the output to a variable

```sh
PID=$(docker inspect -f '{{.State.Pid}}' nginx)
```

Now let's inspect the `/proc` directory for the Nginx process

```sh
ls /proc/$PID
```

The output contains everything related to the container process. Explore the `cgroup` or `environ` files. Feel free to inspect the other files as well.

Now let's inspect the container's root filesystem `/proc/$PID/root`

```sh
ls /proc/$PID/root
bin   dev                  docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
boot  docker-entrypoint.d  etc                   lib   media  opt  root  sbin  sys  usr
```

If we `exec` into the container, we can see the same content from inside the container

```sh
docker exec -it nginx sh
root@ed08325bda2d:/# ls
bin   dev		   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
boot  docker-entrypoint.d  etc			 lib   media  opt  root  sbin  sys  usr
```

## Manipulate the container process

Like any process on the host, you can control it, but with some limitations. You can see below how the container was terminated using the `kill` command without interacting with the Docker daemon.

```sh
ps aux | grep $PID
root        8929  0.0  0.0   8936  5872 ?        Ss   11:30   0:00 nginx: master process nginx -g daemon off;
root        9053  0.0  0.0  17864  2408 pts/4    S+   11:31   0:00 grep --color=auto 8929

docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES
522e39dfc08e   nginx     "/docker-entrypoint.â€¦"   10 minutes ago   Up 7 minutes   80/tcp    nginx

kill -9 $PID

docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```

## Conclusion

We explored how to find a container's process ID and how to access its root filesystem from the host. Unlike virtual machines, containers are isolated processes running in the host. This approach allows Docker to provide lightweight, efficient containerization that can be easily managed and monitored using standard Linux tools. It also allows Docker to run on a wide variety of Linux systems, without requiring any special kernel modifications or configurations.
