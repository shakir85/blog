<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Explaining the basics of Linux inodes and their role in file systems"><title>Understanding inodes</title>
<link rel=canonical href=https://demo.stack.jimmycai.com/p/understanding-inodes/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Understanding inodes"><meta property="og:description" content="Explaining the basics of Linux inodes and their role in file systems"><meta property="og:url" content="https://demo.stack.jimmycai.com/p/understanding-inodes/"><meta property="og:site_name" content="Shakir"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="good to know"><meta property="article:published_time" content="2023-08-16T23:17:40-07:00"><meta property="article:modified_time" content="2023-08-16T23:17:40-07:00"><meta name=twitter:title content="Understanding inodes"><meta name=twitter:description content="Explaining the basics of Linux inodes and their role in file systems"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7eca515642ea01f2249538b3f83662be_6455_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ‘‹</span></figure><div class=site-meta><h1 class=site-name><a href=/>Shakir</a></h1><h2 class=site-description>Brief yet insightful posts covering DevOps, AWS, and the fascinating world of Linux</h2></div></header><ol class=social-menu><li><a href=https://github.com/shakir85 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://gitlab.com/homelabgroup target=_blank title=GitLab rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-gitlab" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-9 7-9-7L6 3l3 7h6l3-7z"/></svg></a></li><li><a href=https://www.linkedin.com/in/almasaari/ target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#why-the-system-needs-something-like-inodes>Why the system needs something like inodes?</a></li><li><a href=#inode-capacity>Inode capacity</a><ol><li><a href=#in-inode-we-trust>In inode, we trust!</a></li></ol></li><li><a href=#reasons-for-inodes-exhaustion>Reasons for inodes exhaustion</a><ol><li><a href=#small-files-and-directories>Small files and directories</a></li><li><a href=#lots-of-small-writes>Lots of small writes</a></li><li><a href=#temporary-files>Temporary files</a></li><li><a href=#software-builds-and-compilation>Software builds and compilation</a></li><li><a href=#excessive-filesystem-operations>Excessive filesystem operations</a></li><li><a href=#bundeld-servers>Bundeld Servers</a></li></ol></li><li><a href=#how-to-fix-inode-exhaustion>How to fix inode exhaustion?</a><ol><li><a href=#identify-the-issue>Identify the issue</a></li><li><a href=#cleanup-and-delete-unnecessary-files>Cleanup and delete unnecessary files</a></li><li><a href=#storage-optimization>Storage optimization</a></li><li><a href=#prevent-it-from-happening-again>Prevent it from happening again</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/linux/>linux</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/understanding-inodes/>Understanding inodes</a></h2><h3 class=article-subtitle>Explaining the basics of Linux inodes and their role in file systems</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 16, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p>In Unix-like operating systems, an inode (short for &ldquo;index node&rdquo;) is a data structure that stores metadata about a file or directory. Each file or directory on a filesystem is associated with a unique inode which contains information such as:</p><ul><li>File type (regular file, directory, symbolic link, device file, etc.)<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</li><li>Permissions (read, write, execute) for the owner, group, and others.</li><li>Ownership (user and group) of the file.</li><li>File size in bytes.</li><li>Timestamps indicate when the file was accessed and modified and when the inode itself was last modified<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</li><li>The number of hard links to the file<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</li><li>Disk block pointers point to the data blocks on the storage device.</li></ul><p><img src=/p/understanding-inodes/example.png width=531 height=111 srcset="/p/understanding-inodes/example_hua27a6af337a5b1ab6468d9c1e64394af_10677_480x0_resize_box_3.png 480w, /p/understanding-inodes/example_hua27a6af337a5b1ab6468d9c1e64394af_10677_1024x0_resize_box_3.png 1024w" loading=lazy alt="&ldquo;Example: inode of an empty file&rdquo;" class=gallery-image data-flex-grow=478 data-flex-basis=1148px></p><p>In this post, I&rsquo;ll cover the basics of inodes â€“ how to identify issues tied to them, and ways to troubleshoot. Keep in mind that inodes can become quite complex because they touch various parts of the filesystem.</p><h2 id=why-the-system-needs-something-like-inodes>Why the system needs something like inodes?</h2><p>When you create a file or directory, there is metadata associated with it, including: file name, size, type, permissions, owner, group, and more. The operating system needs something to manage the file&rsquo;s metadata and the data-blocks location on the disk.</p><p>Therefore, an inode is allocated to store the file (or directory) metadata, which allow the filesystem to properly manage file access and storage. This also make operations like finding files by name, checking permissions, and tracking file sizes easy for the OS.</p><p>This is in general. The specific implementation and terminology may vary slightly depending on the filesystem type and the OS version.</p><h2 id=inode-capacity>Inode capacity</h2><p>For a filesystem, there is a quota for its inodes. The number of inodes available on a filesystem is determined during the filesystem formatting and is usually fixed number. This means that if a filesystem runs out of available inodes, you may be unable to create new files or directories, even if there is a free disk space.</p><h3 id=in-inode-we-trust>In inode, we trust!</h3><p>So, there is a capacity for inodes â€” great. But what happens if we run out of them?</p><p>Running out of inodes (inode exhaustion) can lead to weird system failures. You might suspect that the system has run out of available inodes when a program or process fails to create a file or directory due to insufficient storage, as the error message indicates.</p><p>Generally, it is unlikely to run out of inodes before running out of storage. But this is not impossible, especially when there are a lot of processes <em>writing small files</em> constantly for a long time.</p><p>So if you can&rsquo;t create a file, and the error message states that you do not have enough space, even though you have disk space, then most likely you&rsquo;ve run out of inodes.</p><h2 id=reasons-for-inodes-exhaustion>Reasons for inodes exhaustion</h2><p>Inode exhaustion can be caused by (but not limited to) the following factors:</p><h3 id=small-files-and-directories>Small files and directories</h3><p>If you have a ton of very small files and directories, each will consume an inode, which will quickly deplete the available inode pool. Regardless of whether or not there is plenty of free space on the disk.</p><h3 id=lots-of-small-writes>Lots of small writes</h3><p>Related to the previous point, frequent small writes, such as those caused by a lot of logging or temporary file creation, can contribute to inode exhaustion. These small writes create new inodes each time, and on the long run this can lead to a depletion of available inodes.</p><h3 id=temporary-files>Temporary files</h3><p>Applications that generate many temp files without cleanup can exhaust inodes. These temporary files accumulate and consume inodes if they are not frequently cleaned up.</p><h3 id=software-builds-and-compilation>Software builds and compilation</h3><p>Software development processes involving frequent compilation and code builds can create many temp files and directories. For example, building NodeJS apps is known for creating a ton of small files and cache. Over time, these files can contribute to inode exhaustion.</p><h3 id=excessive-filesystem-operations>Excessive filesystem operations</h3><p>Certain applications or scripts that frequently create, modify, or delete files and directories can lead to inode exhaustion if not properly controlled.</p><h3 id=bundeld-servers>Bundeld Servers</h3><p>Mail servers, content management servers (e.g., WordPress), and backup servers can also be reasons for running out of inodes. So, it&rsquo;s a good practice to be aware of how these servers operate and how they interact with the file system.</p><h2 id=how-to-fix-inode-exhaustion>How to fix inode exhaustion?</h2><p>First, ensure whether youâ€™re running out of inodes or not:
<img src=/p/understanding-inodes/check_available_inodes.png width=915 height=341 srcset="/p/understanding-inodes/check_available_inodes_hu31c45bed60a1c872f961908e5df4c338_52254_480x0_resize_box_3.png 480w, /p/understanding-inodes/check_available_inodes_hu31c45bed60a1c872f961908e5df4c338_52254_1024x0_resize_box_3.png 1024w" loading=lazy alt="&ldquo;Check available inodes&rdquo;" class=gallery-image data-flex-grow=268 data-flex-basis=643px></p><p>You might think that just restarting the server would fix the problem, but that&rsquo;s not necesserly right. The issue is more about the filesystem itself and not the operating system processes.</p><p>The filesystem is persisted on disk, so a reboot does not modify the underlying filesystem properties. If the filesystem was already experiencing inode exhaustion before the reboot, the same issue will persist after the reboot.</p><p>A reboot <em>might</em> be helpful only to clear out stale or stuck processes that keep trying to write tiny files. But the reboot itself does not directly fix the underlying filesystem issue.</p><h3 id=identify-the-issue>Identify the issue</h3><ul><li>Monitor filesystem usage and identify when inode exhaustion occurs.</li><li>Review error messages, logs, and filesystem reports to determine the cause of the issue.</li><li>If you encounter an error message indicating insufficient storage capacity, despite being certain that there is available space, it may suggest an inode issue.</li></ul><h3 id=cleanup-and-delete-unnecessary-files>Cleanup and delete unnecessary files</h3><ul><li>Identify and delete unnecessary files. Check users&rsquo; files, and ensure temporary files are cleaned up.</li><li>Check out the <code>/tpm</code> directory; applications usually use this location for scratch/cache data.</li><li>Clear the cache of package managers by using their command line options or manually locate and remove their cache directory.</li><li>Use tools like <code>find</code> to locate and delete no longer needed files.</li><li>Clean up old log files, and ensure <code>logrotate</code> is enabled and properly configured.</li></ul><h3 id=storage-optimization>Storage optimization</h3><ul><li>Consider compressing unused files.</li><li>Remove redundant files.</li><li>Avoid excessive nested directories.</li><li>Consider using alternative storage like a NAS or other network filesystem.</li></ul><h3 id=prevent-it-from-happening-again>Prevent it from happening again</h3><ul><li>Implement regular automated cleanup tasks.</li><li>Reorganizing and tidying up the whole filesystem might be needed, this will need a storage expert.</li><li>If you&rsquo;re running into this problem often while compiling software in your CI/CD pipeline, you might want to think about using a Docker container to build the app and then stash away the build artifacts using Docker bind mounts or <a class=link href=https://docs.docker.com/build/exporters/ target=_blank rel=noopener>docker exporter</a>. Then delete the build left overs.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The first column of the left of the output of the <code>ls -l</code> command shows file types. The <code>c</code>, <code>d</code> are charcter and device files, <code>l</code> for symlinks, <code>d</code> for directoreis and <code>-</code> for files.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Use <code>stat</code> command to view when a file created, accessed or modified as well as other file info.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Unlike symlinks, which are references to file paths, hard links directly reference the underlying data blocks of a file on disk.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/good-to-know/>good to know</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/importing-functions-in-shell-scripting/><div class=article-details><h2 class=article-title>Importing functions in shell scripting</h2></div></a></article><article><a href=/p/docker-containers-process/><div class=article-details><h2 class=article-title>Docker containers process</h2></div></a></article><article><a href=/p/docker-cmd-and-entrypoint-differences/><div class=article-details><h2 class=article-title>Docker CMD and ENTRYPOINT differences</h2></div></a></article><article><a href=/p/control-the-default-gateway-in-a-dual-nic-host/><div class=article-details><h2 class=article-title>Control the default gateway In a dual NIC host</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Shakir</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>